
{% extends "base.html" %}

{% block head %}
<style>
    * {
        padding: 0;
        margin: 0;
        list-style: none;
        text-decoration: none;
    }

    body {
        background-color: #02b591;
        color: white;
    }

    #wrap {
        width: 100%;
        min-height: 100vh;
        padding: 50px;
        box-sizing: border-box;
    }

    h1 {
        color: rgb(0, 14, 64);
        font-size: 400%;
        margin-bottom: 10px;
        text-align: center;
        font-style: normal;
    }

    .record-container {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }

    .record-header,
    .record-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 10px;
    }

    .record-header .cell:nth-child(1),
    .record-row .cell:nth-child(1) {
        flex: 2;
        /* 학교 */
    }

    .record-header .cell:nth-child(2),
    .record-row .cell:nth-child(2) {
        flex: 2;
        /* 학과 */
    }

    .record-header .cell:nth-child(3),
    .record-row .cell:nth-child(3) {
        flex: 1;
        /* 예상결과 */
    }

    .record-header .cell:nth-child(4),
    .record-row .cell:nth-child(4) {
        flex: 0 0 50px;
        /* 삭제 버튼 고정 */
    }

    .cell {
        flex: 1;
        text-align: center;
        padding: 5px 10px;
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.1);
    }

    .cell.delete {
        flex: 0 0 40px;
        cursor: pointer;
    }

    .cell.delete:hover {
        background-color: red;
        color: white;
    }

    .ex_result .cell {
        color: white;
    }

    h2 {
        display: inline-block;
        padding: 10px 20px;
        border: 1px solid white;
        border-radius: 5px;
        margin-top: 30px;
        background-color: white; /* New: White background */
        color: black; /* New: Black text for visibility */
        cursor: pointer;
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: fit-content;
        transition: background-color 0.3s ease, color 0.3s ease; /* Add transition for smooth hover */
    }

    h2:hover {
        background-color: #02b591; /* Changed to match page background */
        color: white; /* Keep text white for contrast */
    }
</style>
{% endblock %}

{% block content %}
<div id="wrap">
    <h1>기록</h1>

    <div class="record-container">
        <!-- 헤더 -->
        <div class="record-header">
            <div class="cell">학교</div>
            <div class="cell">학과</div>
            <div class="cell">예상결과</div>
            <div class="cell">삭제</div>
        </div>

        <!-- 데이터 행 -->
        {% for r in results %}
        <div class="record-row">
            <div class="cell">{{ r.university }}</div>
            <div class="cell">{{ r.department }}</div>
            <div class="cell ex_result">{{ r.acceptGrade }}</div>
            <div class="cell delete">X</div>
        </div>
        {% endfor %}
    </div>

    <h2 id="confirmBtn">확인</h2>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Add click listener for the confirm button
  document.getElementById("confirmBtn").addEventListener("click", () => {
    window.location.href = "/"; // Redirect to home page
  });

  // 색상 설정
  document.querySelectorAll(".ex_result").forEach(cell => {
    const text = cell.textContent.trim();
    if (text === "지원불가") cell.style.setProperty("background-color", "black", "important");
    else if (text === "상향") cell.style.setProperty("background-color", "red", "important");
    else if (text === "약상향") cell.style.setProperty("background-color", "orange", "important");
    else if (text === "적정") cell.style.setProperty("background-color", "green", "important");
    else if (text === "약하향") cell.style.setProperty("background-color", "skyblue", "important");
    else if (text === "하향") cell.style.setProperty("background-color", "blue", "important");
  });

  // X 버튼 삭제
  document.querySelectorAll(".cell.delete").forEach(btn => {
    btn.addEventListener("click", () => {
      const row = btn.parentElement;
      const university = row.children[0].textContent.trim();
      const department = row.children[1].textContent.trim();
      const userIndex = parseInt(localStorage.getItem("userIndex"), 10);

      fetch("/DELETE_RESULT", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          userIndex: userIndex,
          university: university,
          department: department
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          row.remove(); // 프론트에서도 삭제
        } else {
          alert("삭제 실패: " + data.message);
        }
      })
      .catch(err => {
        console.error(err);
        alert("서버 오류 발생");
      });
    });
  });
});
</script>
{% endblock %}
